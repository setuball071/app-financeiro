<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900">
    <div id="root"></div>
    
    <script type="text/babel">
const { useState, useEffect, useMemo, createContext, useContext } = React;

// --- Contexto para Notificações ---
const NotificationContext = createContext();

const NotificationProvider = ({ children }) => {
    const [notification, setNotification] = useState(null);
    const showNotification = (message, type = 'success') => {
        setNotification({ message, type });
        setTimeout(() => setNotification(null), 5000);
    };
    return (
        <NotificationContext.Provider value={{ showNotification }}>
            {notification && <Notification message={notification.message} type={notification.type} onClose={() => setNotification(null)} />}
            {children}
        </NotificationContext.Provider>
    );
};

const useNotification = () => useContext(NotificationContext);

// --- Configuração do Firebase ---
// !!!!! IMPORTANTE !!!!!
// SUBSTITUA O CONTEÚDO ABAIXO PELAS SUAS CHAVES DO FIREBASE
const firebaseConfig = {
    apiKey: "AIzaSyBgYMLMbDVH7MtsWGS_GQZ7nVmyv1IWsAE",
  authDomain: "meu-financeiro-ee0ac.firebaseapp.com",
  projectId: "meu-financeiro-ee0ac",
  storageBucket: "meu-financeiro-ee0ac.firebasestorage.app",
  messagingSenderId: "389480144669",
  appId: "1:389480144669:web:ce8da22914b264f3e64bf4",
  measurementId: "G-8WMX49SM0T"
};


firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
const appId = firebaseConfig.appId || 'default-app-id';

// --- COLEÇÕES NO FIRESTORE ---
const getCollectionPath = (userId, collectionName) => `/artifacts/${appId}/users/${userId}/${collectionName}`;

// --- Hooks de Dados ---
function useCollection(collectionName) {
    const [data, setData] = useState([]);
    const [user, setUser] = useState(auth.currentUser);
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(currentUser => {
            setUser(currentUser);
        });
        return () => unsubscribe();
    }, []);

    useEffect(() => {
        if (!user) {
            setData([]);
            setIsLoading(false);
            return;
        }
        setIsLoading(true);
        const actualCollectionName = collectionName === 'assets' ? 'investments' : collectionName;
        const q = db.collection(getCollectionPath(user.uid, actualCollectionName)).orderBy("date", "desc");
        const unsubscribe = q.onSnapshot(snapshot => {
            setData(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
            setIsLoading(false);
        }, error => {
            console.error(`Error fetching ${collectionName}:`, error);
            setIsLoading(false);
        });
        return unsubscribe;
    }, [user, collectionName]);

    return { data, isLoading };
}


// --- Componentes da UI ---
const Notification = ({ message, type, onClose }) => {
    const Icon = type === 'success' ? 'fa-circle-check' : 'fa-triangle-exclamation';
    return (<div className={`fixed top-5 right-5 z-50 flex items-center p-4 rounded-lg shadow-lg text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`}>
            <i className={`fas ${Icon} mr-3`}></i>
            <span className="flex-1">{message}</span>
            <button onClick={onClose} className="ml-4 -mr-1 p-1 rounded-md hover:bg-white/20 focus:outline-none"><i className="fas fa-xmark"></i></button>
        </div>
    );
};

const StatCard = ({ title, amount, icon, colorClass, subtitle, isCurrency = true }) => (
    <div className="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg flex items-center space-x-4">
        <div className={`p-3 rounded-full ${colorClass}`}><i className={`fas ${icon} text-xl`}></i></div>
        <div><p className="text-sm text-gray-500 dark:text-gray-400 font-medium">{title}</p><p className="text-2xl font-bold text-gray-800 dark:text-white">{isCurrency ? new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(amount) : amount}</p>{subtitle && <p className="text-xs text-gray-400 dark:text-gray-500">{subtitle}</p>}</div>
    </div>
);

const ConfirmationModal = ({ isOpen, onClose, onConfirm, title, children }) => {
    if (!isOpen) return null;
    return (<div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4"><div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center"><div className="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-500/20"><i className="fas fa-triangle-exclamation text-red-600 dark:text-red-400"></i></div><h3 className="text-lg leading-6 font-bold text-gray-900 dark:text-white mt-4">{title}</h3><div className="mt-2 px-7 py-3"><p className="text-sm text-gray-500 dark:text-gray-400">{children}</p></div><div className="items-center px-4 py-3 flex gap-4"><button onClick={onClose} className="w-full px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md shadow-sm hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none">Cancelar</button><button onClick={onConfirm} className="w-full px-4 py-2 bg-red-600 text-white rounded-md shadow-sm hover:bg-red-700 focus:outline-none">Confirmar</button></div></div></div>);
};

// --- Páginas da Aplicação ---
const DashboardPage = ({ transactions, assets, dollarRate }) => {
    const [date, setDate] = useState({ month: new Date().getMonth() + 1, year: new Date().getFullYear() });
    const filteredTransactions = useMemo(() => transactions.filter(t => {
        const tDate = t.date && t.date.toDate();
        if (!tDate) return false;
        return tDate.getFullYear() === date.year && (tDate.getMonth() + 1) === date.month;
    }), [transactions, date]);
    const { totalIncome, totalExpense, balance } = useMemo(() => {
        const income = filteredTransactions.filter(t => t.type === 'income').reduce((acc, t) => acc + t.amount, 0);
        const expense = filteredTransactions.filter(t => t.type === 'expense').reduce((acc, t) => acc + t.amount, 0);
        return { totalIncome: income, totalExpense: expense, balance: income - expense };
    }, [filteredTransactions]);
    const totalAssetsValue = useMemo(() => assets.reduce((acc, asset) => {
        const totalCurrentValue = (asset.currentValue || 0) * (asset.quantity || 1);
        const valueInBRL = (asset.currency === 'USD' && dollarRate) ? (totalCurrentValue * dollarRate) : totalCurrentValue;
        return acc + (valueInBRL || 0);
    }, 0), [assets, dollarRate]);
    const expenseByCategory = useMemo(() => {
        const expenses = filteredTransactions.filter(t => t.type === 'expense');
        const categoryMap = expenses.reduce((acc, t) => { acc[t.category || 'Outros'] = (acc[t.category || 'Outros'] || 0) + t.amount; return acc; }, {});
        return Object.entries(categoryMap).map(([name, value]) => ({ name, value }));
    }, [filteredTransactions]);
    const expensePercentage = totalIncome > 0 ? (totalExpense / totalIncome) * 100 : 0;
    const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#ff4d4d'];
    const years = [...new Set(transactions.map(t => t.date && t.date.toDate().getFullYear()).filter(y => y))].sort((a,b) => b-a);
    if (years.length === 0 || !years.includes(new Date().getFullYear())) years.unshift(new Date().getFullYear());
    return (<div>
        <div className="flex flex-col sm:flex-row gap-4 mb-8"><select value={date.month} onChange={e => setDate(d => ({...d, month: parseInt(e.target.value)}))} className="w-full sm:w-auto bg-white dark:bg-gray-800 p-2 rounded-lg shadow">{Array.from({length: 12}, (_, i) => <option key={i+1} value={i+1}>{new Date(2000, i).toLocaleString('pt-BR', { month: 'long' })}</option>)}</select><select value={date.year} onChange={e => setDate(d => ({...d, year: parseInt(e.target.value)}))} className="w-full sm:w-auto bg-white dark:bg-gray-800 p-2 rounded-lg shadow">{years.map(y => <option key={y} value={y}>{y}</option>)}</select></div>
        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8"><StatCard title="Receitas do Mês" amount={totalIncome} icon="fa-arrow-up" colorClass="bg-green-100 dark:bg-green-500/20" /><StatCard title="Despesas do Mês" amount={totalExpense} icon="fa-arrow-down" colorClass="bg-red-100 dark:bg-red-500/20" /><StatCard title="Saldo do Mês" amount={balance} icon="fa-wallet" colorClass="bg-blue-100 dark:bg-blue-500/20" /><StatCard title="Total em Ativos" amount={totalAssetsValue} icon="fa-shield-halved" colorClass="bg-yellow-100 dark:bg-yellow-500/20" /></div>
        <div className="grid grid-cols-1 lg:grid-cols-5 gap-8"><div className="lg:col-span-2 bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold text-gray-900 dark:text-white mb-4">Proporção de Uso da Receita</h2><div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-6"><div className="bg-red-500 h-6 rounded-l-full text-center text-white text-sm flex items-center justify-center" style={{ width: `${expensePercentage > 100 ? 100 : expensePercentage}%` }}>{expensePercentage > 15 && `${expensePercentage.toFixed(1)}%`}</div></div><div className="flex justify-between text-sm mt-2 text-gray-600 dark:text-gray-400"><span>Despesas</span><span>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalExpense)}</span></div><div className="flex justify-between text-sm mt-1 text-gray-600 dark:text-gray-400"><span>Sobra (ou falta)</span><span>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalIncome - totalExpense)}</span></div></div><div className="lg:col-span-3 bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold text-gray-900 dark:text-white mb-6">Despesas por Categoria</h2>{expenseByCategory.length > 0 ? (<ResponsiveContainer width="100%" height={200}><PieChart><Pie data={expenseByCategory} dataKey="value" nameKey="name" cx="50%" cy="50%" innerRadius={50} outerRadius={80} fill="#8884d8" paddingAngle={5}>{expenseByCategory.map((entry, index) => <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />)}</Pie><Tooltip formatter={(value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value)} /> <Legend /></PieChart></ResponsiveContainer>) : <p className="text-center text-gray-500 dark:text-gray-400 py-8">Nenhuma despesa registrada para este mês.</p>}</div></div></div>
    );
};

const GenericModal = ({ isOpen, onClose, onSave, title, children, cta="Salvar" }) => {
    if (!isOpen) return null;
    return (<div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4"><div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md"><h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">{title}</h2><form onSubmit={onSave}>{children}<div className="flex justify-end space-x-4 mt-8"><button type="button" onClick={onClose} className="px-6 py-2 rounded-lg text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 font-semibold transition-colors">Cancelar</button><button type="submit" className="px-6 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 font-semibold transition-colors">{cta}</button></div></form></div></div>);
};

const TransactionPage = ({ transactions, isLoading, addTransaction, deleteTransaction }) => {
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [form, setForm] = useState({ description: '', amount: '', category: 'Moradia', type: 'expense', date: new Date().toISOString().split('T')[0]});
    const categories = ['Moradia', 'Alimentação', 'Transporte', 'Lazer', 'Saúde', 'Educação', 'Salário', 'Investimentos', 'Outros', 'Parcelamentos'];
    const handleChange = (e) => setForm({...form, [e.target.name]: e.target.value});
    const handleSubmit = e => {
        e.preventDefault();
        addTransaction({ ...form, amount: parseFloat(form.amount), date: firebase.firestore.Timestamp.fromDate(new Date(form.date)) });
        setIsModalOpen(false);
        setForm({ description: '', amount: '', category: 'Moradia', type: 'expense', date: new Date().toISOString().split('T')[0] });
    };
    return (<React.Fragment><div className="flex justify-between items-center mb-6"><h1 className="text-3xl font-bold">Fluxo de Caixa</h1><button onClick={() => setIsModalOpen(true)} className="flex items-center justify-center bg-blue-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105"><i className="fas fa-plus-circle mr-2"></i> Nova Transação</button></div><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold text-gray-900 dark:text-white mb-4">Histórico de Transações</h2>{isLoading ? ( <p className="text-center text-gray-500 py-8">Carregando...</p> ) : transactions.length === 0 ? ( <div className="text-center py-10"><p className="text-gray-500">Nenhuma transação registrada.</p></div> ) : (<div className="space-y-4">{transactions.map(t => (<div key={t.id} className="flex items-center justify-between p-4 rounded-xl bg-gray-50 dark:bg-gray-700/50"><div className="flex items-center space-x-4"><div className={`p-3 rounded-full ${t.type === 'income' ? 'bg-green-100 dark:bg-green-500/20' : 'bg-red-100 dark:bg-red-500/20'}`}><i className={`fas ${t.type === 'income' ? 'fa-arrow-up' : 'fa-arrow-down'} text-xl ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}`}></i></div><div><p className="font-semibold">{t.description}</p><p className="text-sm text-gray-500 dark:text-gray-400">{t.date && t.date.toDate().toLocaleDateString('pt-BR')} - {t.category}</p></div></div><div className="flex items-center space-x-4"><p className={`font-bold ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>{t.type === 'income' ? '+' : '-'} {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(t.amount)}</p><button onClick={() => deleteTransaction('transactions', t.id)} className="text-gray-400 hover:text-red-500"><i className="fas fa-trash"></i></button></div></div>))}</div>)}</div><GenericModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onSave={handleSubmit} title="Adicionar Transação"><div className="space-y-4"><input name="description" value={form.description} onChange={handleChange} placeholder="Descrição" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><input name="amount" type="number" step="0.01" value={form.amount} onChange={handleChange} placeholder="Valor (R$)" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><input name="date" type="date" value={form.date} onChange={handleChange} required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><select name="category" value={form.category} onChange={handleChange} className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg">{categories.map(c => <option key={c} value={c}>{c}</option>)}</select><div className="flex space-x-4"><button type="button" onClick={() => setForm({...form, type: 'income'})} className={`w-full py-2 rounded-lg ${form.type === 'income' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600'}`}>Receita</button><button type="button" onClick={() => setForm({...form, type: 'expense'})} className={`w-full py-2 rounded-lg ${form.type === 'expense' ? 'bg-red-500 text-white' : 'bg-gray-200 dark:bg-gray-600'}`}>Despesa</button></div></div></GenericModal></React.Fragment>);
};

const InstallmentsPage = ({ data, isLoading, transactions, addItem, deleteItem, updateItem, addTransaction, setNotification }) => {
    const [modal, setModal] = useState({ isOpen: false, data: null, mode: 'add' });
    const [form, setForm] = useState({ name: '', totalValue: '', installments: '' });
    useEffect(() => {
        if(modal.isOpen && modal.mode === 'edit') setForm({ name: modal.data.name, totalValue: modal.data.totalValue, installments: modal.data.installments });
        else setForm({ name: '', totalValue: '', installments: '' });
    }, [modal]);
    const handleSave = (e) => {
        e.preventDefault();
        const itemData = { name: form.name, totalValue: parseFloat(form.totalValue), installments: parseInt(form.installments) };
        if (modal.mode === 'add') addItem({ ...itemData, paidInstallments: 0, date: firebase.firestore.Timestamp.now() });
        else updateItem('installments', modal.data.id, { ...itemData });
        setModal({ isOpen: false });
    };
    const handlePayInstallment = (item) => {
        if (item.paidInstallments >= item.installments) return;
        const monthlyValue = item.totalValue / item.installments;
        addTransaction({ description: `Parcela: ${item.name}`, amount: monthlyValue, category: 'Parcelamentos', type: 'expense', date: firebase.firestore.Timestamp.now(), installmentId: item.id });
        const newPaidCount = item.paidInstallments + 1;
        updateItem('installments', item.id, { paidInstallments: newPaidCount });
        if (newPaidCount === item.installments) setNotification({ type: 'success', message: `Parabéns! Você quitou a dívida "${item.name}".` });
    };
    return (<React.Fragment><div className="flex justify-between items-center mb-6"> <h1 className="text-3xl font-bold">Parcelamentos</h1> <button onClick={() => setModal({isOpen: true, mode: 'add'})} className="flex items-center bg-blue-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg hover:bg-blue-700 transform hover:scale-105 transition-transform"><i className="fas fa-plus-circle mr-2"></i>Adicionar</button> </div><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg">{isLoading ? <p className="text-center py-8">Carregando...</p> : data.length === 0 ? <div className="text-center py-10"><p className="text-gray-500">Nenhum parcelamento registrado.</p></div> : <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{data.map(item => { const monthlyValue = item.totalValue / item.installments; const remainingValue = (item.installments - item.paidInstallments) * monthlyValue; const isPaidThisMonth = transactions.some(t => t.installmentId === item.id && t.date && t.date.toDate().getMonth() === new Date().getMonth() && t.date.toDate().getFullYear() === new Date().getFullYear()); const isFullyPaid = item.paidInstallments >= item.installments; return (<div key={item.id} className="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-xl shadow-md flex flex-col"><div className="flex-grow space-y-3"><div className="flex justify-between items-start"><h3 className="font-bold text-lg pr-2">{item.name}</h3><div className="flex gap-2"><button onClick={() => setModal({isOpen: true, data: item, mode: 'edit'})} className="text-gray-400 hover:text-blue-500"><i className="fas fa-edit"></i></button><button onClick={() => deleteItem('installments', item.id)} className="text-gray-400 hover:text-red-500 flex-shrink-0"><i className="fas fa-trash"></i></button></div></div><p className="text-sm">Valor Parcela: <b>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(monthlyValue)}</b></p><p className="text-sm">Valor Restante: <b>{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(remainingValue)}</b></p><div className="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5"><div className="bg-blue-600 h-2.5 rounded-full" style={{ width: `${(item.paidInstallments / item.installments) * 100}%` }}></div></div><p className="text-sm text-center font-medium">{item.paidInstallments} / {item.installments} parcelas pagas</p></div><button onClick={() => handlePayInstallment(item)} disabled={isPaidThisMonth || isFullyPaid} className="mt-4 w-full flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md transition-colors disabled:cursor-not-allowed bg-green-500 text-white hover:bg-green-600 disabled:bg-gray-400 dark:disabled:bg-gray-500">{isFullyPaid ? 'Quitado' : isPaidThisMonth ? 'Pagamento do mês lançado' : <> <i className="fas fa-check-square mr-2"></i> Lançar Pagamento </>}</button></div>)})}</div>}</div><GenericModal isOpen={modal.isOpen} onClose={() => setModal({isOpen: false})} onSave={handleSave} title={modal.mode === 'add' ? 'Adicionar Parcelamento' : 'Editar Parcelamento'}><div className="space-y-4"><input value={form.name} onChange={e => setForm({...form, name: e.target.value})} placeholder="Nome (Ex: Financiamento Imóvel)" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><input type="number" step="0.01" value={form.totalValue} onChange={e => setForm({...form, totalValue: e.target.value})} placeholder="Valor Total" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><input type="number" value={form.installments} onChange={e => setForm({...form, installments: e.target.value})} placeholder="Número de Parcelas" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/></div></GenericModal></React.Fragment>);
}

const AssetsPage = ({ data, isLoading, addItem, deleteItem, updateItem, dollarRate }) => {
    const [modal, setModal] = useState({ isOpen: false, data: null, mode: 'add' });
    const initialFormState = { name: '', type: 'Renda Fixa', currency: 'BRL', quantity: '1', purchasePrice: '', currentValue: '' };
    const [form, setForm] = useState(initialFormState);
    const assetTypes = ["Renda Fixa", "Ações", "Fundos Imobiliários", "Criptomoedas", "Imóvel", "Veículo", "Outros Bens"];
    const [converterValue, setConverterValue] = useState('');
    
    useEffect(() => {
        if(modal.isOpen && modal.mode === 'edit') {
            const item = modal.data;
            setForm({ name: item.name || '', type: item.type || 'Renda Fixa', currency: item.currency || 'BRL', quantity: item.quantity || '1', purchasePrice: item.purchasePrice || '', currentValue: item.currentValue || '' });
        } else { setForm(initialFormState); }
    }, [modal]);

    const handleSave = (e) => {
        e.preventDefault();
        const itemData = {
            name: form.name, type: form.type, currency: form.currency,
            quantity: parseFloat(form.quantity), purchasePrice: parseFloat(form.purchasePrice),
            currentValue: parseFloat(form.currentValue) || parseFloat(form.purchasePrice),
            date: modal.mode === 'add' ? firebase.firestore.Timestamp.now() : modal.data.date,
        };
        if (modal.mode === 'add') addItem(itemData);
        else updateItem('investments', modal.data.id, itemData);
        setModal({ isOpen: false, data: null });
    };

     return (<React.Fragment><div className="flex justify-between items-center mb-6"><h1 className="text-3xl font-bold">Meus Ativos</h1><div className="flex items-center gap-4"><div className="bg-white dark:bg-gray-800 p-2 rounded-lg shadow-md"><label className="text-xs text-purple-600 dark:text-purple-400 font-semibold">Conversor Rápido (USD ⇄ BRL)</label><div className="flex items-center gap-2"><input type="number" value={converterValue} onChange={(e) => setConverterValue(e.target.value)} placeholder="Valor em US$" className="w-24 p-1 bg-gray-100 dark:bg-gray-700 rounded-md text-sm"/><span className="text-gray-500">=</span><span className="font-bold text-gray-800 dark:text-white">{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format((converterValue || 0) * (dollarRate || 0))}</span></div></div><button onClick={() => setModal({ isOpen: true, mode: 'add'})} className="flex items-center bg-blue-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg hover:bg-blue-700 transform hover:scale-105 transition-transform"><i className="fas fa-plus-circle mr-2"></i> Adicionar Ativo</button></div></div><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg">{isLoading ? <p className="text-center py-8">Carregando...</p> : data.length === 0 ? <div className="text-center py-10"><p className="text-gray-500">Nenhum ativo registrado.</p></div> : <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{data.map(item => {
                const isUSD = item.currency === 'USD';
                const cost = (item.purchasePrice || 0) * (item.quantity || 1);
                const displayValueTotal = (item.currentValue || 0) * (item.quantity || 1);
                const profitLoss = displayValueTotal - cost;
                const profitLossPercent = cost > 0 ? (profitLoss / cost) * 100 : 0;
                return (<div key={item.id} className="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-xl shadow-md space-y-3 relative"><div className="absolute top-3 right-3 flex gap-2"><button onClick={() => setModal({isOpen: true, data: item, mode: 'edit'})} className="text-gray-400 hover:text-blue-500"><i className="fas fa-edit"></i></button><button onClick={() => deleteItem('investments', item.id)} className="text-gray-400 hover:text-red-500"><i className="fas fa-trash"></i></button></div><span className={`text-xs font-semibold px-2 py-1 rounded-full ${item.type.includes('Renda') || item.type.includes('Imóvel') ? 'bg-green-100 text-green-800' : 'bg-purple-100 text-purple-800'}`}>{item.type} {isUSD && `(USD)`}</span><h3 className="font-bold text-lg pt-1">{item.name}</h3><p className="text-2xl font-bold">{new Intl.NumberFormat(isUSD ? 'en-US' : 'pt-BR', { style: 'currency', currency: isUSD ? 'USD' : 'BRL' }).format(displayValueTotal)}</p>{isUSD && <p className="text-sm text-gray-500 -mt-2">≈ {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(displayValueTotal * (dollarRate || 0))}</p> }<div className="text-sm space-y-1 text-gray-600 dark:text-gray-300"><p>Custo de Aquisição: {new Intl.NumberFormat(isUSD ? 'en-US' : 'pt-BR', { style: 'currency', currency: isUSD ? 'USD' : 'BRL' }).format(cost)}</p><p className={profitLoss >= 0 ? 'text-green-500' : 'text-red-500'}>Lucro/Prejuízo: {new Intl.NumberFormat(isUSD ? 'en-US' : 'pt-BR', { style: 'currency', currency: isUSD ? 'USD' : 'BRL' }).format(profitLoss)} ({profitLossPercent.toFixed(2)}%)</p></div></div>)})}</div>}</div><GenericModal isOpen={modal.isOpen} onClose={() => setModal({isOpen: false})} onSave={handleSave} title={modal.mode === 'add' ? "Adicionar Ativo" : "Editar Ativo"}><div className="space-y-4"><input value={form.name} onChange={e => setForm({...form, name: e.target.value})} placeholder="Nome do Ativo" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><select value={form.type} onChange={e => setForm({...form, type: e.target.value})} className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg">{assetTypes.map(type => <option key={type}>{type}</option>)}</select><select value={form.currency} onChange={e => setForm({...form, currency: e.target.value})} className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"><option value="BRL">BRL</option><option value="USD">USD</option></select><input type="number" step="any" value={form.quantity} onChange={e => setForm({...form, quantity: e.target.value})} placeholder="Quantidade" required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><input type="number" step="0.01" value={form.purchasePrice} onChange={e => setForm({...form, purchasePrice: e.target.value})} placeholder={`Custo de Aquisição (Unitário em ${form.currency})`} required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/><input type="number" step="0.01" value={form.currentValue} onChange={e => setForm({...form, currentValue: e.target.value})} placeholder={`Valor Atual de Mercado (Unitário em ${form.currency})`} required className="w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg"/></div></GenericModal></React.Fragment>);
}

const ImportPage = ({ onImport, setNotification }) => {
    const [pastedData, setPastedData] = useState('');
    const [isImporting, setIsImporting] = useState(false);
    const handleImport = async (e) => {
        e.preventDefault();
        if (!pastedData.trim()) { setNotification({ type: 'error', message: 'Por favor, cole os dados na área de texto.' }); return; }
        setIsImporting(true);
        const rows = pastedData.trim().split('\n'); const transactionsToImport = []; const errors = [];
        rows.forEach((row, index) => {
            const columns = row.split('\t');
            if (columns.length < 5) { errors.push(`Linha ${index + 1}: Formato inválido.`); return; }
            try {
                let [dateStr, , typeStr, category, description, valueStr] = columns.length >= 6 ? columns : [columns[0], null, ...columns.slice(1)];
                const dateParts = dateStr.split('/'); if (dateParts.length !== 3) throw new Error('Formato de data inválido');
                let year = parseInt(dateParts[2], 10); if (year < 100) year += 2000;
                const date = new Date(year, parseInt(dateParts[1], 10) - 1, parseInt(dateParts[0], 10)); if (isNaN(date.getTime())) throw new Error('Data inválida');
                const amount = parseFloat(valueStr.replace('R$', '').replace(/\./g, '').replace(',', '.').trim()); if (isNaN(amount)) throw new Error('Valor inválido');
                const type = typeStr.trim().toLowerCase().includes('receita') ? 'income' : 'expense';
                transactionsToImport.push({ date: firebase.firestore.Timestamp.fromDate(date), type, category: category.trim(), description: description.trim(), amount: Math.abs(amount) });
            } catch (error) { errors.push(`Linha ${index + 1}: ${error.message}`); }
        });
        if (errors.length > 0) { setNotification({ type: 'error', message: `Erros: ${errors.slice(0, 3).join('; ')}...` }); setIsImporting(false); return; }
        if (transactionsToImport.length > 0) { try { await onImport(transactionsToImport); setNotification({ type: 'success', message: `${transactionsToImport.length} transações importadas!` }); setPastedData(''); } catch (error) { setNotification({ type: 'error', message: `Erro ao salvar: ${error.message}` }); } }
        setIsImporting(false);
    };
    return (<div><h1 className="text-3xl font-bold mb-6">Importar Transações do Excel</h1><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold mb-4">Instruções</h2><div className="bg-blue-50 dark:bg-blue-500/10 p-4 rounded-lg border-l-4 border-blue-400"><ol className="list-decimal list-inside space-y-2 text-gray-700 dark:text-gray-200"><li>No Excel, organize as colunas: <code className="bg-gray-200 dark:bg-gray-600 p-1 rounded">Data | Tipo | Categoria | Descrição | Valor</code></li><li>'Tipo' deve ser "Receita" ou "Despesa".</li><li>'Data' deve ser <code className="bg-gray-200 dark:bg-gray-600 p-1 rounded">DD/MM/AAAA</code> ou <code className="bg-gray-200 dark:bg-gray-600 p-1 rounded">DD/MM/AA</code>.</li><li>Copie as linhas (sem o cabeçalho) e cole abaixo.</li></ol></div><form onSubmit={handleImport} className="mt-6"><textarea value={pastedData} onChange={(e) => setPastedData(e.target.value)} placeholder="Cole os dados do Excel aqui..." className="w-full h-64 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg font-mono text-sm border border-gray-200 dark:border-gray-600 focus:ring-2 focus:ring-blue-500" disabled={isImporting} /><div className="text-right mt-4"><button type="submit" disabled={isImporting || !pastedData} className="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">{isImporting ? 'Importando...' : 'Importar'}</button></div></form></div></div>);
};

const NetWorthPage = ({ assets, installments, dollarRate }) => {
    const getAIFeedback = (item, type) => {
        if (type === 'asset') {
            const itemType = item.type.toLowerCase();
            if (itemType.includes('ações') || itemType.includes('cripto')) return "Ativo de renda variável com potencial de alta valorização e maior risco.";
            if (itemType.includes('renda fixa')) return "Ativo de baixo risco, ideal para preservação de capital e previsibilidade.";
            if (itemType.includes('veículo')) return "Ativo que tende a depreciar com o tempo, mas representa valor de liquidez.";
            if (itemType.includes('imóvel')) return "Ativo de baixa liquidez com alto potencial de valorização a longo prazo.";
            return "Este ativo contribui positivamente para o seu patrimônio líquido.";
        }
        if (type === 'liability') {
            const itemName = item.name.toLowerCase();
            if (itemName.includes('imóvel') || itemName.includes('terreno')) return "Passivo de longo prazo que, apesar de ser uma dívida, pode se tornar um ativo valioso.";
            if (itemName.includes('carro') || itemName.includes('veículo')) return "Este passivo tende a depreciar com o tempo, impactando seu patrimônio.";
            return "Esta dívida compromete sua renda e reduz seu patrimônio líquido.";
        }
    };
    const { totalAssets, totalLiabilities, netWorth } = useMemo(() => {
        const totalAssets = assets.reduce((acc, item) => {
            const totalCurrentValue = (item.currentValue || 0) * (item.quantity || 1);
            const valueInBRL = (item.currency === 'USD' && dollarRate) ? totalCurrentValue * dollarRate : totalCurrentValue;
            return acc + valueInBRL;
        }, 0);
        const totalLiabilities = installments.reduce((acc, item) => acc + ((item.totalValue / item.installments) * (item.installments - item.paidInstallments)), 0);
        return { totalAssets, totalLiabilities, netWorth: totalAssets - totalLiabilities };
    }, [assets, installments, dollarRate]);
    return (<div><h1 className="text-3xl font-bold mb-6">Controle de Patrimônio</h1><div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><StatCard title="Total de Ativos" amount={totalAssets} icon="fa-arrow-up" colorClass="bg-green-100 dark:bg-green-500/20" /><StatCard title="Total de Passivos" amount={totalLiabilities} icon="fa-arrow-down" colorClass="bg-red-100 dark:bg-red-500/20" /><StatCard title="Patrimônio Líquido" amount={netWorth} icon="fa-scale-balanced" colorClass="bg-blue-100 dark:bg-blue-500/20" /></div><div className="grid grid-cols-1 lg:grid-cols-2 gap-8"><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold mb-4">Ativos</h2><div className="space-y-4">{assets.map(item => { const totalCurrentValue = (item.currentValue || 0) * (item.quantity || 1); const finalValue = (item.currency === 'USD' && dollarRate) ? totalCurrentValue * dollarRate : totalCurrentValue; return (<div key={item.id} className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg"><div className="flex justify-between items-center"><span className="font-semibold">{item.name}</span> <span className="font-bold text-green-500">{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(finalValue)}</span></div><p className="text-xs text-gray-500 dark:text-gray-400 mt-2 flex items-center"><i className="fas fa-brain mr-2 text-purple-400"></i> {getAIFeedback(item, 'asset')}</p></div>)})} {assets.length === 0 && <p className="text-center text-gray-500 py-4">Nenhum ativo registrado.</p>}</div></div><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold mb-4">Passivos</h2><div className="space-y-4">{installments.map(item => { const remainingValue = (item.totalValue / item.installments) * (item.installments - item.paidInstallments); return (<div key={item.id} className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg"><div className="flex justify-between items-center"><span className="font-semibold">{item.name}</span> <span className="font-bold text-red-500">{new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(remainingValue)}</span></div><p className="text-xs text-gray-500 dark:text-gray-400 mt-2 flex items-center"><i className="fas fa-brain mr-2 text-purple-400"></i> {getAIFeedback(item, 'liability')}</p></div>)})} {installments.length === 0 && <p className="text-center text-gray-500 py-4">Nenhum passivo (parcelamento) registrado.</p>}</div></div></div></div>);
};

const SettingsPage = ({ theme, setTheme }) => {
    const themes = [ { id: 'light', name: 'Claro', icon: 'fa-sun' }, { id: 'dark', name: 'Escuro', icon: 'fa-moon' }, { id: 'system', name: 'Sistema', icon: 'fa-desktop' }];
    return (<div><h1 className="text-3xl font-bold mb-6">Configurações</h1><div className="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg"><h2 className="text-xl font-bold text-gray-900 dark:text-white mb-4">Tema da Aparência</h2><div className="grid grid-cols-1 sm:grid-cols-3 gap-4">{themes.map(t => (<button key={t.id} onClick={() => setTheme(t.id)} className={`flex flex-col items-center justify-center p-6 rounded-lg border-2 transition-colors ${theme === t.id ? 'border-blue-500 bg-blue-50 dark:bg-blue-500/20' : 'border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700'}`}><i className={`fas ${t.icon} text-2xl ${theme === t.id ? 'text-blue-600' : 'text-gray-500'}`}></i><span className="mt-2 font-semibold">{t.name}</span></button>))}</div></div></div>);
};

// --- Componente Principal ---
const FinanceApp = ({ user }) => {
    const [activePage, setActivePage] = useState('dashboard');
    const [isMenuOpen, setIsMenuOpen] = useState(false);
    const [confirmModal, setConfirmModal] = useState({ isOpen: false });
    const [dollarRate, setDollarRate] = useState(null);
    useEffect(() => { const fetchDollarRate = async () => { try { const response = await fetch('https://economia.awesomeapi.com.br/json/last/USD-BRL'); const data = await response.json(); setDollarRate(parseFloat(data.USDBRL.bid)); } catch (error) { console.error("Erro ao buscar cotação do dólar:", error); showNotification({ type: 'error', message: 'Não foi possível buscar a cotação do dólar.' });} }; fetchDollarRate(); }, []);
    const { data: transactions, isLoading: loadingTransactions } = useCollection('transactions');
    const { data: installments, isLoading: loadingInstallments } = useCollection('installments');
    const { data: assets, isLoading: loadingAssets } = useCollection('assets'); 
    const { showNotification } = useNotification();
    const handleAddItem = async (collectionName, item) => { if (!user) return; const actualCollection = collectionName === 'assets' ? 'investments' : collectionName; try { await db.collection(getCollectionPath(user.uid, actualCollection)).add(item); showNotification('Item adicionado com sucesso!'); } catch (error) { console.error("Error adding item:", error); showNotification('Erro ao adicionar item.', 'error'); }};
    const handleImportTransactions = async (transactionsToImport) => { if (!user || transactionsToImport.length === 0) return; try { const batch = db.batch(); const collectionRef = db.collection(getCollectionPath(user.uid, 'transactions')); transactionsToImport.forEach(transaction => batch.set(collectionRef.doc(), transaction)); await batch.commit(); showNotification(`${transactionsToImport.length} transações importadas!`); } catch (error) { console.error("Error importing:", error); showNotification('Erro ao importar transações.', 'error'); throw error; } };
    const handleUpdateItem = async (collectionName, itemId, data) => { if (!user) return; const actualCollection = collectionName === 'assets' ? 'investments' : collectionName; try { await db.collection(getCollectionPath(user.uid, actualCollection)).doc(itemId).update(data); showNotification('Item atualizado com sucesso!'); } catch (error) { console.error("Error updating item:", error); showNotification('Erro ao atualizar item.', 'error'); } };
    const handleDeleteItem = (collectionName, itemId) => { if (!user) return; const actualCollection = collectionName === 'assets' ? 'investments' : collectionName; setConfirmModal({ isOpen: true, title: "Confirmar Exclusão", message: "Tem a certeza que deseja apagar este item? Esta ação não pode ser desfeita.", onConfirm: async () => { try { await db.collection(getCollectionPath(user.uid, actualCollection)).doc(itemId).delete(); showNotification('Item apagado com sucesso!'); } catch (error) { console.error("Error deleting item:", error); showNotification('Erro ao apagar item.', 'error'); } setConfirmModal({ isOpen: false }); } }); };
    const navItems = [ { id: 'dashboard', label: 'Dashboard', icon: 'fa-chart-pie' }, { id: 'patrimonio', label: 'Patrimônio', icon: 'fa-shield-halved' }, { id: 'transactions', label: 'Fluxo de Caixa', icon: 'fa-exchange-alt' }, { id: 'installments', label: 'Parcelamentos', icon: 'fa-landmark' }, { id: 'assets', label: 'Ativos', icon: 'fa-coins' }, { id: 'import', label: 'Importar', icon: 'fa-upload' }, { id: 'settings', label: 'Configurações', icon: 'fa-cog' }];
    const renderPage = () => {
        switch(activePage) {
            case 'dashboard': return <DashboardPage transactions={transactions} assets={assets} dollarRate={dollarRate}/>;
            case 'patrimonio': return <NetWorthPage installments={installments} assets={assets} dollarRate={dollarRate} />;
            case 'transactions': return <TransactionPage transactions={transactions} isLoading={loadingTransactions} addTransaction={(item) => handleAddItem('transactions', item)} deleteTransaction={handleDeleteItem} />;
            case 'installments': return <InstallmentsPage data={installments} isLoading={loadingInstallments} transactions={transactions} addItem={(item) => handleAddItem('installments', item)} deleteItem={handleDeleteItem} updateItem={handleUpdateItem} addTransaction={(item) => handleAddItem('transactions', item)} setNotification={showNotification} />;
            case 'assets': return <AssetsPage data={assets} isLoading={loadingAssets} addItem={(item) => handleAddItem('assets', item)} deleteItem={handleDeleteItem} updateItem={handleUpdateItem} dollarRate={dollarRate} />;
            case 'import': return <ImportPage onImport={handleImportTransactions} setNotification={showNotification} />;
            case 'settings': return <SettingsPage theme={localStorage.getItem('theme') || 'system'} setTheme={(theme) => { localStorage.setItem('theme', theme); if (theme === 'dark') document.documentElement.classList.add('dark'); else if (theme === 'light') document.documentElement.classList.remove('dark'); else { localStorage.removeItem('theme'); if (window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); } document.documentElement.dataset.theme = theme; }} />;
            default: return <DashboardPage transactions={transactions} assets={assets} dollarRate={dollarRate} />;
        }
    }
    return (<div className="flex min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
        <aside className={`bg-white dark:bg-gray-800 shadow-xl z-20 absolute inset-y-0 left-0 transform ${isMenuOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition-transform duration-200 ease-in-out w-64 flex flex-col`}><div className="p-5 text-center"> <h2 className="text-2xl font-bold text-blue-600 dark:text-blue-400">Meu Financeiro</h2> </div><nav className="mt-8 flex-grow">{navItems.map(item => (<a key={item.id} href="#" onClick={(e) => { e.preventDefault(); setActivePage(item.id); setIsMenuOpen(false); }} className={`flex items-center py-3 px-6 my-1 transition-colors duration-200 ${activePage === item.id ? 'bg-blue-50 dark:bg-blue-500/20 text-blue-600 dark:text-blue-300 border-r-4 border-blue-500' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'}`}><i className={`fas ${item.icon} mr-4`}></i> {item.label}</a>))}</nav><div className="p-4 border-t border-gray-200 dark:border-gray-700"><div className="flex items-center"><i className="fas fa-user-circle text-4xl text-gray-400"></i><div className="ml-3 overflow-hidden"><p className="text-sm font-semibold text-gray-800 dark:text-white truncate">{user.isAnonymous ? "Usuário Anônimo" : user.displayName}</p><p className="text-xs text-gray-500 dark:text-gray-400 truncate">{user.uid}</p></div></div></div></aside>
        <main className="flex-1 p-4 md:p-8 overflow-y-auto"><button onClick={() => setIsMenuOpen(!isMenuOpen)} className="md:hidden p-2 rounded-md bg-white dark:bg-gray-800 shadow mb-4 z-30"><i className="fas fa-bars"></i></button>{renderPage()}</main>
        <ConfirmationModal isOpen={confirmModal.isOpen} onClose={() => setConfirmModal({ isOpen: false })} onConfirm={confirmModal.onConfirm} title={confirmModal.title}> {confirmModal.message} </ConfirmationModal>
    </div>);
}

const App = () => {
    const [user, setUser] = useState(null);
    const [isAuthReady, setIsAuthReady] = useState(false);

    useEffect(() => {
        const savedTheme = localStorage.getItem('theme') || 'system';
        document.documentElement.dataset.theme = savedTheme;
        if (savedTheme === 'dark') document.documentElement.classList.add('dark');
        else if (savedTheme === 'light') document.documentElement.classList.remove('dark');
        else { if (window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }

        const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
            if (currentUser) {
                setUser(currentUser);
            } else {
                 try {
                    const userCredential = await auth.signInAnonymously();
                    setUser(userCredential.user);
                 } catch (anonError) { console.error("Erro no login anônimo:", anonError); }
            }
            setIsAuthReady(true);
        });
        return () => unsubscribe();
    }, []);

    if (!isAuthReady) {
        return <div className="flex flex-col justify-center items-center h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-white"><i className="fas fa-wallet text-5xl text-blue-500 animate-pulse"></i><p className="mt-4">Carregando seu painel financeiro...</p></div>;
    }
    
    if (isAuthReady && !user) {
         return <div className="flex flex-col justify-center items-center h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-white"><i className="fas fa-triangle-exclamation text-5xl text-red-500"></i><h1 className="text-2xl font-bold mt-4">Erro de Autenticação</h1><p className="mt-2 text-center text-gray-500 dark:text-gray-400">Não foi possível autenticar sua conta. <br />Por favor, recarregue a página.</p></div>
    }

    return (
        <NotificationProvider>
            <FinanceApp user={user} />
        </NotificationProvider>
    );
}

ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>